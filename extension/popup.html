<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="popup.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <div class="popup">

    <!-- Header -->
    <header class="header">
      <div class="brand">
        <svg class="brand-icon" width="26" height="26" viewBox="0 0 26 26" fill="none">
          <circle cx="13" cy="13" r="12" fill="#3B82F6"/>
          <path d="M8.5 13l3.5 3.5 5.5-7" stroke="white" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="brand-name">Dealink</span>
      </div>
      <button class="close-btn" id="close-btn" aria-label="סגור">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </header>

    <!-- ── LOADING ── -->
    <div id="state-loading" class="state">
      <div class="loading-center">
        <div class="pulse-wrap">
          <div class="pulse-ring"></div>
          <div class="pulse-core">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#3B82F6" stroke-width="2.2" stroke-linecap="round">
              <circle cx="11" cy="11" r="8"/>
              <line x1="21" y1="21" x2="16.65" y2="16.65"/>
            </svg>
          </div>
        </div>
        <h2 class="loading-title">מחפש את הדיל הכי טוב</h2>
        <p class="loading-sub" id="loading-msg">בודק Amazon, eBay, Walmart...</p>
        <div class="prog-row">
          <div class="prog-track">
            <div class="prog-fill" id="progress-fill"></div>
          </div>
          <span class="prog-pct" id="progress-text">0%</span>
        </div>
      </div>
    </div>

    <!-- ── RESULTS ── -->
    <div id="state-results" class="state hidden">

      <!-- Sort pills -->
      <div class="sort-row" id="sort-bar">
        <span class="sort-label">מיין:</span>
        <button class="spill active" data-sort="price">מחיר</button>
        <button class="spill" data-sort="popularity">פופולרי</button>
        <button class="spill" data-sort="rating">דירוג</button>
      </div>

      <!-- Savings hero -->
      <div class="hero-banner" id="hero-banner">
        <div class="hero-left">
          <p class="hero-label">חסכון שמצאנו לך</p>
          <p class="hero-amount" id="hero-amount">$47.50</p>
        </div>
        <div class="hero-right">
          <span class="hero-pct" id="hero-sub">-38%</span>
        </div>
      </div>

      <!-- Best deal -->
      <div class="best-card" id="best-deal-card">
        <div class="best-header">
          <span class="trophy-tag">🏆 הכי זול</span>
          <span class="disc-pill" id="best-deal-badge">-38%</span>
        </div>
        <div class="best-body">
          <img class="store-icon lg" id="best-deal-logo" src="" alt="">
          <div class="best-info">
            <div class="best-store" id="best-deal-store-name"></div>
            <div class="best-ship" id="best-deal-shipping"></div>
            <div class="best-meta" id="best-deal-meta"></div>
          </div>
          <div class="best-right">
            <span class="best-price" id="best-deal-price"></span>
            <a class="buy-btn" id="best-deal-link" href="#">לקנות →</a>
          </div>
        </div>
        <div class="savings-strip" id="best-deal-savings"></div>
      </div>

      <!-- Other deals -->
      <p class="section-lbl" id="more-label">עוד אפשרויות</p>
      <div class="deal-stack" id="results-list"></div>

      <button class="expand-btn hidden" id="show-more-btn">
        <span id="show-more-text">הצג עוד</span>
        <span class="expand-chip" id="show-more-count"></span>
        <svg class="chev" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <polyline points="6 9 12 15 18 9"/>
        </svg>
      </button>
      <div class="deal-stack hidden" id="results-list-extra"></div>

      <!-- Used/Refurbished -->
      <div id="used-section" class="sub-block hidden">
        <button class="sub-toggle" id="used-toggle">
          <span class="sub-label">♻️ משומש / מחודש</span>
          <span class="count-chip" id="used-count-badge">0</span>
          <svg class="chev" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <polyline points="6 9 12 15 18 9"/>
          </svg>
        </button>
        <div class="deal-stack hidden" id="used-list"></div>
      </div>

      <!-- Similar -->
      <div id="similar-section" class="sub-block hidden">
        <button class="sub-toggle" id="similar-toggle">
          <span class="sub-label">מוצרים דומים</span>
          <svg class="chev" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <polyline points="6 9 12 15 18 9"/>
          </svg>
        </button>
        <div class="deal-stack hidden" id="similar-list"></div>
      </div>

    </div>

    <!-- ── NO PRODUCT ── -->
    <div id="state-no-product" class="state hidden">
      <div class="center-state">
        <div class="state-icon">🛍️</div>
        <h2 class="state-title">עבור לדף מוצר</h2>
        <p class="state-sub">Dealink ישווה מחירים אוטומטית ב-50+ חנויות</p>
        <div class="store-chips">
          <img src="https://www.google.com/s2/favicons?domain=amazon.com&sz=32" alt="Amazon" title="Amazon">
          <img src="https://www.google.com/s2/favicons?domain=ebay.com&sz=32" alt="eBay" title="eBay">
          <img src="https://www.google.com/s2/favicons?domain=walmart.com&sz=32" alt="Walmart" title="Walmart">
          <img src="https://www.google.com/s2/favicons?domain=bestbuy.com&sz=32" alt="Best Buy" title="Best Buy">
          <img src="https://www.google.com/s2/favicons?domain=target.com&sz=32" alt="Target" title="Target">
          <img src="https://www.google.com/s2/favicons?domain=newegg.com&sz=32" alt="Newegg" title="Newegg">
        </div>
      </div>
    </div>

    <!-- ── NO DEALS ── -->
    <div id="state-no-deals" class="state hidden">
      <div class="center-state">
        <div class="state-icon">✨</div>
        <h2 class="state-title">זה המחיר הטוב ביותר!</h2>
        <p class="state-sub">בדקנו עשרות חנויות — אתה כבר בהצעה הכי טובה.</p>
      </div>
    </div>

    <!-- ── ERROR ── -->
    <div id="state-error" class="state hidden">
      <div class="center-state">
        <div class="state-icon">😕</div>
        <h2 class="state-title">משהו השתבש</h2>
        <p class="state-sub" id="error-message">לא הצלחנו לחפש מחירים.</p>
        <button class="action-btn" id="retry-btn">↺ נסה שוב</button>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <button class="f-link" id="report-btn">דווח על בעיה</button>
      <span class="f-sep">·</span>
      <a href="privacy-policy.html" target="_blank" class="f-link">פרטיות</a>
    </footer>

  </div>
  <script src="popup.js"></script>
</body>
</html>
